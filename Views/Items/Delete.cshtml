@model YourProjectName.Models.Item
@using System.Text.Json
@{
    Layout = "_Layout";
}

<!-- Vue.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>

<div id="app">
    <h2>Delete Item</h2>
    <h4>Are you sure you want to delete this item?</h4>
    <div>
        <dl class="row">
            <dt class="col-sm-2">ID</dt>
            <dd class="col-sm-10">{{ item.Id }}</dd>
            <dt class="col-sm-2">Name</dt>
            <dd class="col-sm-10">{{ item.Name }}</dd>
        </dl>
        <form id="vueDeleteForm">
            <input type="hidden" v-model="item.Id" name="Id" />
            <button type="submit" class="btn btn-danger">Delete</button>
            <a href="/Items" class="btn btn-secondary">Cancel</a>
        </form>
    </div>
</div>

<script>
    new Vue({
        el: '#app',
        data: {
            item: @Html.Raw(JsonSerializer.Serialize(Model))
        },
        mounted() {
            document.getElementById('vueDeleteForm').addEventListener('submit', this.submitForm);
        },
        methods: {
            submitForm(e) {
                e.preventDefault();
                fetch('/Items/Delete', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(this.item)
                })
                .then(res => {
                    if (!res.ok) {
                        return res.text().then(text => { throw new Error(text); });
                    }
                    return res.json();
                })
                .then(data => {
                    if (data.success && data.redirectUrl) {
                        window.location = data.redirectUrl;
                    } else {
                        alert('Failed to delete item.');
                    }
                })
                .catch(err => {
                    alert('Error: ' + err.message);
                });
            }
        }
    });
</script>
